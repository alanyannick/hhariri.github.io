---
layout: post
title: Running Code Coverage from the Console with dotCover
categories: []
tags:
- dotCover
status: publish
type: post
published: true
meta:
  _elasticsearch_indexed_on: '2010-07-28 04:25:02'
comments: true
---
<p>As of the beta* of <a href="http://www.jetbrains.com/dotcover">dotCover</a>, we included a Console runner to run coverage using the command line, allowing for instance, setup of dotCover in a Continuous Integration environment. Let’s see how it works.</p> <p>*To get all these features in this post, you need to download the <a href="http://confluence.jetbrains.net/display/DCVR/dotCover+1.0+Nightly+Builds">latest nightly build</a></p> <h3>&nbsp;</h3> <h3>Console Runner</h3> <p>The Console runner is located under the installation folder (%Program Files%\JetBrains\dotCover\v1.0\bin\dotCover.exe). The best option is to add it to the system path so as to be able to run it from anywhere. The runner accepts several commands based on the operation we want to perform. Each of these commands in turn takes one parameter, which is an XML configuration file. The commands are:</p> <ul> <li>cover: Coverage of specified application  <li>merge: Merges snapshots  <li>report: Creates an XML report of the coverage results  <li>list: Lists snapshots  <li>delete: Deletes snapshots  <li>analyse: Provides an all-in-one analysis and output </li></ul> <p>We can also obtain a list of commands by typing <font face="couri"><strong>dotCover.exe help</strong></font> on the command line:</p> <p><a href="http://hhariri.files.wordpress.com/2010/11/115.png"><img style="display:inline;border-width:0;" title="1" border="0" alt="1" src="http://hhariri.files.wordpress.com/2010/11/1_thumb2.png" width="743" height="149"></a> </p> <p>As shown in the figure above, we can find out more about each command by typing <strong>help </strong>followed by the command. All commands (including <strong>help</strong>) have corresponding shortcuts. For instance, to get information about analyse, we can type:</p> <p><strong>dotCover.exe help analyse </strong></p> <p>or</p> <p><strong>dotCover.exe h a</strong></p> <p>Since all commands take as parameter an XML file, when requesting help, all they do is generate a sample XML with comments indicating what each element means. The previous command would therefore output:</p> <p><a href="http://hhariri.files.wordpress.com/2010/11/214.png"><img style="display:inline;border-width:0;" title="2" border="0" alt="2" src="http://hhariri.files.wordpress.com/2010/11/2_thumb2.png" width="650" height="249"></a> </p> <p>The obvious advantage to this is that we can easily get a new configuration file setup by just asking for help and piping the output to some file. In fact, adding a third filename parameter, dotCover will do this for us, without us having to touch up the output (remove headers, etc.).</p> <h3>Coverage in one command</h3> <p>The dotCover console runner is flexible in that it complies with most common requirements in a Continuous Integration setup. Normally in projects, we have multiple test projects we need to cover. We might then want to see the results separately or merge them as one report. dotCover allows for this kind of flexibility. However, in many cases, all we want to do is run coverage on a single test project and see the results. We’ll see how to do that in a single step in this blog post and in a future post we’ll get into the details or merging, listing, etc.</p> <p>Let’s see how to do this step by step. I’ll be using a sample app that I’ve prepared for this blog post (using MSpec). You can adjust the parameters to your own project paths and unit testing framework as required.</p> <p>&nbsp;</p> <ol> <li>Type <strong>dotcover help analyse coverage.xml </strong>on the command line. I’m doing this in the root folder of my solution. <br><br><a href="http://hhariri.files.wordpress.com/2010/11/313.png"><img style="display:inline;border-width:0;" title="3" border="0" alt="3" src="http://hhariri.files.wordpress.com/2010/11/3_thumb2.png" width="202" height="249"></a> <br> <li>Add coverage.xml to the Solution and open it up in Visual Studio  <li>Eliminate all elements except the following <br><br>&nbsp;<a href="http://hhariri.files.wordpress.com/2010/11/413.png"><img style="display:inline;border-width:0;" title="4" border="0" alt="4" src="http://hhariri.files.wordpress.com/2010/11/4_thumb2.png" width="644" height="130"></a> <br> <li>Fill in the elements with the corresponding values: <br><br><strong>Executable</strong>: Is the path to the unit testing framework runner (in this case mspec.exe) <br><strong>Arguments</strong>: Arguments passed to the runner, the test assemblies (specs.dll) <br><strong>WorkingDir</strong>: Optional path to the working folder (provide this to not have to fully qualify test assemblies) <br><strong>Output</strong>: XML Report containing coverage information. Relative to the coverage.xml path (output.xml) <br><br>&nbsp;<a href="http://hhariri.files.wordpress.com/2010/11/513.png"><img style="display:inline;border-width:0;" title="5" border="0" alt="5" src="http://hhariri.files.wordpress.com/2010/11/5_thumb2.png" width="590" height="164"></a> <br> <li>That’s it in terms of configuration. Now all we need to do is run it by typing <strong>dotCover analyse coverage.xml. </strong>If all is configured correctly, we should see the following output: <br><br><a href="http://hhariri.files.wordpress.com/2010/11/612.png"><img style="display:inline;border-width:0;" title="6" border="0" alt="6" src="http://hhariri.files.wordpress.com/2010/11/6_thumb1.png" width="650" height="115"></a> <br><br>and there should be an output.xml file located in the same folder. Opening it up we can see the coverage results <br><br><a href="http://hhariri.files.wordpress.com/2010/11/73.png"><img style="display:inline;border-width:0;" title="7" border="0" alt="7" src="http://hhariri.files.wordpress.com/2010/11/7_thumb2.png" width="404" height="249"></a> </li></ol> <p>&nbsp;</p> <h3>Filtering from the Console</h3> <p>Looking at the results, we can see that there is a lot of noise, that is, assemblies that we’re not interested in such as the tests, MSpec assemblies, etc. In a previous blog post, <a href="http://hadihariri.com/blogengine/post/2010/07/08/Filtering-with-dotCover.aspx">we saw how to filter these out using dotCover GUI</a>. Let’s see how we can do this via the command line. If we generate the default coverage configuration, we can<br>see that there is a filter section:</p> <p><a href="http://hhariri.files.wordpress.com/2010/11/83.png"><img style="display:inline;border-width:0;" title="8" border="0" alt="8" src="http://hhariri.files.wordpress.com/2010/11/8_thumb1.png" width="487" height="249"></a> </p> <p>These are used to filter assemblies. We can indicate which assemblies we want covered and which we don’t. In order to filter out all assemblies and concentrate only on our actual code (ClassLib), we can do one of two things:</p> <ol> <li>Filter out all non-required assemblies individually by adding them to the <strong>ExcludeFilters </strong>section, as in: <br><br>&nbsp;<a href="http://hhariri.files.wordpress.com/2010/11/94.png"><img style="display:inline;border-width:0;" title="9" border="0" alt="9" src="http://hhariri.files.wordpress.com/2010/11/9_thumb2.png" width="314" height="391"></a> <br> <li>Exclude everything that’s not specifically in the Include section. This is done by leaving an <strong>ExcludeFilter </strong>section blank and placing what we want covered in the <strong>IncludeFilter</strong>: <br><br><a href="http://hhariri.files.wordpress.com/2010/11/104.png"><img style="display:inline;border-width:0;" title="10" border="0" alt="10" src="http://hhariri.files.wordpress.com/2010/11/10_thumb2.png" width="332" height="249"></a> </li></ol> <p>Based on the needs and depending on which of the two lists (Include or Exclude) are smaller, we can opt for option 1 or 2. The ouput should now be filtered:</p> <p><a href="http://hhariri.files.wordpress.com/2010/11/116.png"><img style="display:inline;border-width:0;" title="11" border="0" alt="11" src="http://hhariri.files.wordpress.com/2010/11/11_thumb2.png" width="650" height="241"></a> </p> <p>&nbsp;</p> <h3>Giving it some style</h3> <p>Only thing left to do is to format the output so that it can be viewed nicely inside a browser. This can be done easily using XSLT and some appropriate design skills (something I lack).</p> <p><a href="http://hhariri.files.wordpress.com/2010/11/124.png"><img style="display:inline;border-width:0;" title="12" border="0" alt="12" src="http://hhariri.files.wordpress.com/2010/11/12_thumb2.png" width="556" height="324"></a> </p> <p>Included <a href="http://github.com/hhariri/Blog/tree/master/dotCoverConsoleAndTestCoverage/">in the project</a> you have an XSLT to create some HTML as well as one to covert the XML to JSON. Having JSON output allows us to combine it with something like jQuery to display a nice treeview or grid with the results.</p>
