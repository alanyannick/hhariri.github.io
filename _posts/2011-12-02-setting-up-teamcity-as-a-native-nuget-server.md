---
layout: post
title: Setting up TeamCity as a native NuGet Server
categories:
- JetBrains
tags:
- NuGet
- TeamCity
status: publish
type: post
published: true
meta:
  reddit: a:2:{s:5:"count";i:0;s:4:"time";i:1385521009;}
  _elasticsearch_indexed_on: '2011-12-02 14:42:00'
---
<p>&nbsp;</p> <p><a href="http://blogs.jetbrains.com/teamcity/2011/11/24/new-teamcity-7-0-eap-build-20702/">TeamCity 7.0 EAP (Early Access Program) was recently opened</a> and one of the new features is the built-in support for NuGet. I recently blogged about setting up <a href="http://blogs.jetbrains.com/dotnet/2011/08/native-nuget-support-in-teamcity/">TeamCity to pack and publish NuGet packages via a plug-in</a> and this plug-in is now included by default in TeamCity 7. However, the real new interesting feature is that TeamCity is now a native NuGet repository too! </p> <h3>Native NuGet Server? </h3> <p>Many of those that have been using NuGet, have most likely been using it to consume packages from nuget.org where there are currently over 3800 unique packages, most of which are open source. </p> <p align="center"><img style="background-image:none;padding-left:0;padding-right:0;display:inline;padding-top:0;border-width:0;margin:10px 0 0;" title="image" border="0" alt="image" src="http://hhariri.files.wordpress.com/2011/12/image.png" width="483" height="138"></p> <p align="justify">&nbsp;</p> <p align="justify">What happens however if for some reason or another you do not want to submit packages to nuget.org? For instance, think that you want to use NuGet to modularize and distribute code inside your own organization, or create libraries for private consumption. In this case, publishing to nuget.org does not make sense. This leaves you with basically two options:</p> <p align="justify">&nbsp;</p> <ol> <li> <div align="justify">Setup your own NuGet repository by downloading and installing the code that nuget.org for instance</div> <li> <div align="justify">Copy nuget packages to a local share and have everyone read off of that</div></li></ol> <p align="justify">&nbsp;</p> <p align="justify">Both of these options come with their own share of overhead. With the local share you now require sharing of folders and permissions. Setting up your own NuGet repository also requires managing permissions and whatnot separately. At the end of the day, its another service to manage. </p> <p align="justify">Fortunately, you now have a third option: TeamCity. The same server that builds your projects, runs your tests, packs and publishes your packages can now also serve them. The best part of it is that it is so simple, that I had to take up the rest of this blog with the previous nonsense just to give it some meat. </p> <h3 align="justify">Enabling TeamCity as a NuGet Server</h3> <p align="justify">I am not going to cover how to pack and publish packages in this post. All that is covered in detail in the <a href="http://blogs.jetbrains.com/dotnet/2011/08/native-nuget-support-in-teamcity/">previous post</a> I wrote, so please read that first if you’re not familiar with the process. Enabling TeamCity as NuGet and making packages available consists of two steps:</p> <p align="justify">&nbsp;</p> <h4 align="justify">1. Enable the server to be a NuGet server</h4> <p align="justify">&nbsp;</p> <p align="justify">Go to <strong>Administration | Server Configuration | NuGet</strong> tab</p> <p align="justify">&nbsp;</p> <p align="justify"><img style="background-image:none;padding-left:0;padding-right:0;display:inline;padding-top:0;border-width:0;margin:10px 0 0;" title="image" border="0" alt="image" src="http://hhariri.files.wordpress.com/2011/12/image1.png" width="679" height="306"></p> <p align="justify">Click on the <strong>Enable</strong> button to enable it. The same screen with then display two different feeds: a public and a private one:</p> <p align="justify">&nbsp;</p> <p align="justify"><img style="background-image:none;padding-left:0;padding-right:0;display:inline;padding-top:0;border-width:0;margin:10px 0 0;" title="image" border="0" alt="image" src="http://hhariri.files.wordpress.com/2011/12/image2.png" width="628" height="269"></p> <p>If by chance the Public Url is not available, you will probably see a message telling you that you <strong>need to enable the Guest account in TeamCity</strong>, which can be done from the General tab.</p> <p>&nbsp;</p> <h4>2. Make your packages be your Artifacts</h4> <p>Since TeamCity itself is going to be a NuGet server, the step to publish a package is no longer required. However, packing the package is. In this step (<strong>NuGet Pack Build Type</strong>), we can just configure the output for the package to point to some specific folder, for instance <em>packages</em></p> <p>&nbsp;</p> <p><img style="background-image:none;padding-left:0;padding-right:0;display:inline;padding-top:0;border-width:0;margin:10px 0 0;" title="image" border="0" alt="image" src="http://hhariri.files.wordpress.com/2011/12/image3.png" width="885" height="123"></p> <p>&nbsp;</p> <p>We need instruct TeamCity to ouput the results of this folder as artifacts. This is done in the <strong>General Settings</strong> step of the Build Configuration</p> <p>&nbsp;</p> <p><img style="background-image:none;padding-left:0;padding-right:0;display:inline;padding-top:0;border-width:0;margin:10px 0 0;" title="image" border="0" alt="image" src="http://hhariri.files.wordpress.com/2011/12/image4.png" width="752" height="200"></p> <p>&nbsp;</p> <p>and with that, we’re done. Next up is to configure Visual Studio to consume from this feed.</p> <p>&nbsp;</p> <h3>Configuring Visual Studio</h3> <p>Although this step is optional, it is recommended to add your repositories to Visual Studio to avoid having to type long URL’s in each time you want to read from a specific package repository. To do this, click on <strong>Options | Library Package Manager | Package Manager Settings</strong></p> <p>&nbsp;</p> <p><img style="background-image:none;padding-left:0;padding-right:0;display:inline;padding-top:0;border-width:0;margin:10px 0 0;" title="image" border="0" alt="image" src="http://hhariri.files.wordpress.com/2011/12/image5.png" width="617" height="420"></p> <p>&nbsp;</p> <p>We need to add a new NuGet Repository. I’ve called it <em>Local TeamCity</em>&nbsp; and the URL corresponds to the public URL provided to me by TeamCity in Step 1:</p> <p>&nbsp;</p> <p><img style="background-image:none;padding-left:0;padding-right:0;display:inline;padding-top:0;border-width:0;margin:10px 0 0;" title="image" border="0" alt="image" src="http://hhariri.files.wordpress.com/2011/12/image6.png" width="479" height="384"></p> <p>&nbsp;</p> <p>Notice that I have another entry which is <em>Local TeamCity Auth </em>which corresponds to the authenticated version. </p> <p>Once we have this, we can now easily consume packages from our repository by merely specifying it in the Package Manager Console, either via the Combobox or explicitly in each call:</p> <p>&nbsp;</p> <p><img style="background-image:none;padding-left:0;padding-right:0;display:inline;padding-top:0;border-width:0;margin:10px 0 0;" title="image" border="0" alt="image" src="http://hhariri.files.wordpress.com/2011/12/image7.png" width="743" height="161"></p> <p>&nbsp;</p> <p>&nbsp;</p> <h3>Summary</h3> <p>That’s all there is to it. By merely publishing our packages as artifacts, TeamCity now provides a full-fledged nuget server which opens up great possibilities when it comes to working and managing dependencies between projects. TeamCity is currently in EAP and much of what I’ve described here is in open to improvements. That is why your feedback is very important. <a href="http://confluence.jetbrains.net/display/TW/TeamCity+EAP">Download 7 and start playing with it today</a>. Let us know what you think. </p>
