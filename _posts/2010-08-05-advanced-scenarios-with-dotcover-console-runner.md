---
layout: post
title: Advanced scenarios with dotCover Console Runner
categories: []
tags:
- dotCover
status: publish
type: post
published: true
meta:
  _elasticsearch_indexed_on: '2010-08-05 10:20:00'
comments: true
---
<p>In an <a href="/blogengine/post/2010/07/28/Running-Code-Coverage-from-the-Console-with-dotCover.aspx">earlier post</a>, we saw how to use dotCover in simple scenarios, whereby we have a single unit test project for which we want to obtain coverage reports on. There are times however, when this is not the case; that is, we might have multiple tests projects. It is very common (and recommended practice) to separate Unit test projects from Integration test projects, allowing us to run the former more frequently during development and the latter during an Automated Continuous Integration setup. In these cases, running the dotCover <em>analyse </em>command, as shown in the <a href="/blogengine/post/2010/07/28/Running-Code-Coverage-from-the-Console-with-dotCover.aspx">previous post</a> might not be ideal.</p>  <h3>&#160;</h3>  <h3>Fine tuning the coverage steps</h3>  <p>For the scenarios described, whereas we have multiple test projects, dotCover allows us to fine-tune the coverage process by offering us a series of commands that breakdown the coverage, merging and reporting into individual steps. Suppose we have the following Project Layout</p>  <p>&#160;<a href="http://hhariri.files.wordpress.com/2010/11/213.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="21" border="0" alt="21" src="http://hhariri.files.wordpress.com/2010/11/21_thumb.png" width="319" height="378" /></a> </p>  <p>&#160;</p>  <p>The AppCode is our application code that we want to run coverage for, and TestProject1 and TestProject2 are specific the test projects that cover AppCode. These can be Unit Test or Integration Test projects. The process we need to follow is shown in the figure below:</p>  <p>&#160;</p>  <p><a href="http://hhariri.files.wordpress.com/2010/11/222.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="22" border="0" alt="22" src="http://hhariri.files.wordpress.com/2010/11/22_thumb.png" width="415" height="333" /></a> </p>  <p>&#160;</p>  <p>&#160;</p>  <p>We run coverage on each of the tests projects by using the <em>cover </em>(c) command using the following configuration file (corresponds to testProject1.xml. testProject2.xml is similar)</p>  <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:b1c874cd-f63d-4869-bea4-c3123d90e351" class="wlWriterSmartContent">   <div class="le-pavsc-container">     <div style="background-color:#000000;white-space:nowrap;padding:2px 5px;"><span style="color:#ffffff;">&lt;?</span><span style="color:#cc7832;">xml</span><span style="color:#ffffff;"> version=&quot;</span><span style="color:#a5c25c;">1.0</span><span style="color:#ffffff;">&quot; encoding=&quot;</span><span style="color:#a5c25c;">utf-8</span><span style="color:#ffffff;">&quot;?&gt;</span>        <br /><span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">CoverageParams</span><span style="color:#ffffff;">&gt;</span>        <br />&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">Executable</span><span style="color:#ffffff;">&gt;</span>        <br />&#160;&#160;&#160; <span style="color:#ffffff;">X:\Libraries\nUnit\nunit-console.exe</span>        <br />&#160; <span style="color:#ffffff;">&lt;/</span><span style="color:#cc7832;">Executable</span><span style="color:#ffffff;">&gt;</span>        <br />&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">Arguments</span><span style="color:#ffffff;">&gt;TestProject1.dll&lt;/</span><span style="color:#cc7832;">Arguments</span><span style="color:#ffffff;">&gt;</span>        <br />&#160;&#160;&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">WorkingDir</span><span style="color:#ffffff;">&gt;TestProject1\bin\debug&lt;/</span><span style="color:#cc7832;">WorkingDir</span><span style="color:#ffffff;">&gt;</span>        <br />&#160;&#160;&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">Output</span><span style="color:#ffffff;">&gt;output1.xml&lt;/</span><span style="color:#cc7832;">Output</span><span style="color:#ffffff;">&gt;</span>        <br />&#160;&#160;&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">Filters</span><span style="color:#ffffff;">&gt;</span>        <br />&#160;&#160;&#160;&#160;&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">IncludeFilters</span><span style="color:#ffffff;">&gt;</span>        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">FilterEntry</span><span style="color:#ffffff;">&gt;</span>        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">ModuleMask</span><span style="color:#ffffff;">&gt;AppCode&lt;/</span><span style="color:#cc7832;">ModuleMask</span><span style="color:#ffffff;">&gt;</span>        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">ClassMask</span><span style="color:#ffffff;">&gt;*&lt;/</span><span style="color:#cc7832;">ClassMask</span><span style="color:#ffffff;">&gt;</span>        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">FunctionMask</span><span style="color:#ffffff;">&gt;*&lt;/</span><span style="color:#cc7832;">FunctionMask</span><span style="color:#ffffff;">&gt;</span>        <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color:#ffffff;">&lt;/</span><span style="color:#cc7832;">FilterEntry</span><span style="color:#ffffff;">&gt;</span>        <br />&#160;&#160;&#160;&#160;&#160; <span style="color:#ffffff;">&lt;/</span><span style="color:#cc7832;">IncludeFilters</span><span style="color:#ffffff;">&gt;</span>        <br />&#160;&#160;&#160;&#160;&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">ExcludeFilters</span><span style="color:#ffffff;">&gt;</span>        <br />&#160;&#160;&#160;&#160;&#160; <span style="color:#ffffff;">&lt;/</span><span style="color:#cc7832;">ExcludeFilters</span><span style="color:#ffffff;">&gt;</span>        <br />&#160;&#160;&#160; <span style="color:#ffffff;">&lt;/</span><span style="color:#cc7832;">Filters</span><span style="color:#ffffff;">&gt;</span>        <br /><span style="color:#ffffff;">&lt;/</span><span style="color:#cc7832;">CoverageParams</span><span style="color:#ffffff;">&gt;</span></div>   </div> </div>  <p>[Command to execute: dotcover c testProject1.xml]</p>  <p>Executing this command generates a snapshot file with coverage data, the Coverage Results Descriptor (by default, unless specified in the configuration file using the <strong>TempDir </strong>element, the snapshots are saved in the User temporary folder). These snapshots are not the final XML report that we are after but intermediate information that dotCover uses to generate reports from. There is a correspondence between snapshots and processes, such that each process generates a single snapshot. In our case, since we are calling a unit testing framework to launch a single test project, there will only be one snapshot. However there are cases, for instance when running coverage report on an application, whereby the application can launch another process&#160; itself. In this case, multiple snapshots will be generated.</p>  <p>When we run this command, once for each Project, we end up with two snapshot files. We now need to merge the snapshots in order to generate the XML report. This is accomplished using the <em>merge </em>(m) command</p>  <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:7427fc54-3cb7-48fb-a05a-99b9a57e3ea0" class="wlWriterSmartContent">   <div class="le-pa&#010;vsc-container">     <div style="background-color:#000000;white-space:nowrap;padding:2px 5px;"><span style="color:#ffffff;">&lt;?</span><span style="color:#cc7832;">xml</span><span style="color:#ffffff;"> version=&quot;</span><span style="color:#a5c25c;">1.0</span><span style="color:#ffffff;">&quot; encoding=&quot;</span><span style="color:#a5c25c;">utf-8</span><span style="color:#ffffff;">&quot;?&gt;</span>        <br /><span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">MergeParams</span><span style="color:#ffffff;">&gt;</span>        <br />&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">Source</span><span style="color:#ffffff;">&gt; </span>        <br />&#160;&#160;&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">string</span><span style="color:#ffffff;">&gt;output1.xml&lt;/</span><span style="color:#cc7832;">string</span><span style="color:#ffffff;">&gt;</span>        <br />&#160;&#160;&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">string</span><span style="color:#ffffff;">&gt;output2.xml&lt;/</span><span style="color:#cc7832;">string</span><span style="color:#ffffff;">&gt;</span>        <br />&#160; <span style="color:#ffffff;">&lt;/</span><span style="color:#cc7832;">Source</span><span style="color:#ffffff;">&gt;</span>        <br />&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">Output</span><span style="color:#ffffff;">&gt;output_merged.xml&lt;/</span><span style="color:#cc7832;">Output</span><span style="color:#ffffff;">&gt;</span>        <br /><span style="color:#ffffff;">&lt;/</span><span style="color:#cc7832;">MergeParams</span><span style="color:#ffffff;">&gt;</span></div>   </div> </div>  <p>[Command to execute: dotcover m merge.xml]</p>  <p>which takes the output of the two <em>cover </em>commands (output1.xml and output2.xml) and generates a single snapshot file. The only thing remaining is to generate an XML coverage report based off of this data, using the <em>report </em>command</p>  <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:45955b53-a02d-4dde-82dd-2749d45907cf" class="wlWriterSmartContent">   <div class="le-pavsc-container">     <div style="background-color:#000000;white-space:nowrap;padding:2px 5px;"><span style="color:#ffffff;">&lt;?</span><span style="color:#cc7832;">xml</span><span style="color:#ffffff;"> version=&quot;</span><span style="color:#a5c25c;">1.0</span><span style="color:#ffffff;">&quot; encoding=&quot;</span><span style="color:#a5c25c;">utf-8</span><span style="color:#ffffff;">&quot;?&gt;</span>        <br /><span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">ReportParams</span><span style="color:#ffffff;">&gt;</span>        <br />&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">Source</span><span style="color:#ffffff;">&gt;output_merged.xml&lt;/</span><span style="color:#cc7832;">Source</span><span style="color:#ffffff;">&gt;</span>        <br />&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">Output</span><span style="color:#ffffff;">&gt;results_merged.xml&lt;/</span><span style="color:#cc7832;">Output</span><span style="color:#ffffff;">&gt;</span>        <br /><span style="color:#ffffff;">&lt;/</span><span style="color:#cc7832;">ReportParams</span><span style="color:#ffffff;">&gt;</span></div>   </div> </div>  <p>[Command to execute: dotcover r report.xml]</p>  <p>providing us with the XML report containing coverage information (percentage of code covered, statements covered), which like in the <a href="/blogengine/post/2010/07/28/Running-Code-Coverage-from-the-Console-with-dotCover.aspx">previous post</a> we can apply an XSLT to format into HTML or JSON.</p>  <h3>Other Coverage Commands</h3>  <p>dotCover provides two more commands:</p>  <ul>   <li>list </li>    <li>delete </li> </ul>  <p>The <em>list</em> command simply obtains a list of all snapshot files given the coverage descriptors, that is, the output of the different <em>cover </em>commands. The configuration file lists these descriptors:</p>  <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:9f9c12e1-9260-4c2e-aacf-aa9d3fdb36e0" class="wlWriterSmartContent">   <div class="le-pavsc-container">     <div style="background-color:#000000;white-space:nowrap;padding:2px 5px;"><span style="color:#ffffff;">&lt;?</span><span style="color:#cc7832;">xml</span><span style="color:#ffffff;"> version=&quot;</span><span style="color:#a5c25c;">1.0</span><span style="color:#ffffff;">&quot; encoding=&quot;</span><span style="color:#a5c25c;">utf-8</span><span style="color:#ffffff;">&quot;?&gt;</span>        <br /><span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">ListParams</span><span style="color:#ffffff;">&gt;</span>        <br />&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">Source</span><span style="color:#ffffff;">&gt;&lt;!--</span><span style="color:#c0c0c0;"> Required. At least one child element expected. </span><span style="color:#ffffff;">--&gt;</span>        <br />&#160;&#160;&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">string</span><span style="color:#ffffff;">&gt;&lt;!--</span><span style="color:#c0c0c0;"> Coverage results descriptor 1 file name </span><span style="color:#ffffff;">--&gt;&lt;/</span><span style="color:#cc7832;">string</span><span style="color:#ffffff;">&gt;</span>        <br />&#160;&#160;&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">string</span><span style="color:#ffffff;">&gt;&lt;!--</span><span style="color:#c0c0c0;"> Coverage results descriptor 2 file name </span><span style="color:#ffffff;">--&gt;&lt;/</span><span style="color:#cc7832;">string</span><span style="color:#ffffff;">&gt;</span>        <br />&#160;&#160;&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">string</span><span style="color:#ffffff;">&gt;&lt;!--</span><span style="color:#c0c0c0;"> Coverage results descriptor N file name </span><span style="color:#ffffff;">--&gt;&lt;/</span><span style="color:#cc7832;">string</span><span style="color:#ffffff;">&gt;</span>        <br />&#160; <span style="color:#ffffff;">&lt;/</span><span style="color:#cc7832;">Source</span><span style="color:#ffffff;">&gt;</span>        <br />&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">Output</span><span style="color:#ffffff;">&gt;&lt;!--</span><span style="color:#c0c0c0;"> Required. Resulting file name. Stores plain list of all snapshot files. </span><span style="color:#ffffff;">--&gt;&lt;/</span><span style="color:#cc7832;">Output</span><span style="color:#ffffff;">&gt;</span>        <br /><span style="color:#ffffff;">&lt;/</span><span style="color:#cc7832;">ListParams</span><span style="color:#ffffff;">&gt;</span></div>   </div> </div>  <p>&#160;</p>  <p>The <em>delete </em>command deletes the list of given snapshots:</p>  <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:e373fa63-8b15-40c7-a0ec-6ab66a10d533" class="wlWriterSmartContent">   <div class="le-pavsc-container">     <div style="background-color:#000000;white-space:nowrap;padding:2px 5px;"><span style="color:#ffffff;">&lt;?</span><span style="color:#cc7832;">xml</span><span style="color:#ffffff;"> version=&quot;</span><span style="color:#a5c25c;">1.0</span><span style="color:#ffffff;">&quot; encoding=&quot;</span><span style="color:#a5c25c;">utf-8</span><span style="color:#ffffff;">&quot;?&gt;</span>        <br /><span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">DeleteParams</span><span style="color:#ffffff;">&gt;</span>        <br />&amp;nbs        <br />p; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">Source</span><span style="color:#ffffff;">&gt;&lt;!--</span><span style="color:#c0c0c0;"> Required. At least one child element expected. </span><span style="color:#ffffff;">--&gt;</span>        <br />&#160;&#160;&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">string</span><span style="color:#ffffff;">&gt;&lt;!--</span><span style="color:#c0c0c0;"> Coverage results descriptor 1 file name </span><span style="color:#ffffff;">--&gt;&lt;/</span><span style="color:#cc7832;">string</span><span style="color:#ffffff;">&gt;</span>        <br />&#160;&#160;&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">string</span><span style="color:#ffffff;">&gt;&lt;!--</span><span style="color:#c0c0c0;"> Coverage results descriptor 2 file name </span><span style="color:#ffffff;">--&gt;&lt;/</span><span style="color:#cc7832;">string</span><span style="color:#ffffff;">&gt;</span>        <br />&#160;&#160;&#160; <span style="color:#ffffff;">&lt;</span><span style="color:#cc7832;">string</span><span style="color:#ffffff;">&gt;&lt;!--</span><span style="color:#c0c0c0;"> Coverage results descriptor N file name </span><span style="color:#ffffff;">--&gt;&lt;/</span><span style="color:#cc7832;">string</span><span style="color:#ffffff;">&gt;</span>        <br />&#160; <span style="color:#ffffff;">&lt;/</span><span style="color:#cc7832;">Source</span><span style="color:#ffffff;">&gt;</span>        <br /><span style="color:#ffffff;">&lt;/</span><span style="color:#cc7832;">DeleteParams</span><span style="color:#ffffff;">&gt;</span></div>   </div> </div>  <h3>&#160;</h3>  <h3>Summary</h3>  <p>As we can see, dotCover allows us to fine-tune the coverage process by letting us control the different steps. One question that might arise is why couldn’t we have done the same by running the <em>analyse </em>command twice, once for each Test Project. If we were to do that, we would get two independent reports, whereas here the results are all merged into a single report. The <em>analyse </em>command is a great fit for simple scenarios that only have a single project. Once we move onto more complex setups, having a finer control over the coverage process has its benefits.</p>
