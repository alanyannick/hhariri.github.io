---
layout: post
title: 'dotCover: Code Coverage for .NET'
categories: []
tags:
- dotCover
status: publish
type: post
published: true
meta:
  _elasticsearch_indexed_on: '2010-03-30 12:07:00'
---
<p>Last week we announced a new product by <a href="http://www.jetbrains.com">JetBrains</a> for .NET developers: <a href="http://www.jetbrains.com/dotcover">dotCover</a>, a code coverage tool. We are aiming to open the EAP this week and some of our <a href="http://www.jetbrains.com/devnet/academy/experts/index.html">Academy Members</a> have already been playing with it since last week. In this post I’m going to provide some more info on how it works.</p> <p>&nbsp;</p> <h3>Code Coverage 101</h3> <p>Code Coverage is a means by which you measure the percentage of your code that is covered by tests. Technically,the higher the percentage, the less chances of finding hidden bugs when it’s too late. You could therefore assume that 100% coverage is ideal, and you’d most likely be wrong. Having your entire code base covered by tests doesn’t necessarily mean that you are safe. Code Coverage analyzes what parts of your code are covered by tests. It doesn’t tell you whether the code you’ve written is correct. Additionally having a higher percentage often gives a false sense of security, that the code is now bug-free and doesn’t require any other type of testing.</p> <p>Does this mean therefore, that Code Coverage is useless? Quite the contrary. Code Coverage tools normally provide, at a minimum, two pieces of relevant information: the percentage of code covered and the actual lines of code covered. However, what is important is not so much the code that is covered, but what is not covered. If I have a code base with 70% code coverage, what is more valuable to me than knowing that 30% of my code is not tested, is finding out what the code is. This allows for me to find potential issues that would otherwise go unnoticed.</p> <h3>Testing code for coverage with dotCover</h3> <p>&nbsp;</p> <p><strong>Disclaimer: At the time of writing this blog post, dotCover is still pre EAP so not everything might work as expected</strong></p> <p>It should somehow be apparent that coverage tools need to work in conjunction with testing frameworks and unit tests. I’m going to base this post on the sample MVC application that ships with ASP.NET MVC 2, the one that comes with some default controllers, not the blank one, you know, the one that doesn’t even bother asking us whether we want a unit test project or not. The project ships with two controllers, <em>HomeController </em>and <em>AccountController</em> along with some corresponding tests.</p> <p><a href="http://hhariri.files.wordpress.com/2010/11/126.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="1" border="0" alt="1" src="http://hhariri.files.wordpress.com/2010/11/1_thumb8.png" width="172" height="249"></a> </p> <p>Similar to <a href="http://www.jetbrains.com/dottrace">dotTrace</a>, dotCover works nicely with <a href="http://www.jetbrains.com/resharper">ReSharper</a>. When you install dotCover, you see several options appear in the ReSharper menu options as well as the Test Runner window. First of all, under <em>ReSharper | Unit Tests </em>menu option, there is a new option to run coverage reports, either for specific tests or for the entire solution.</p> <p><a href="http://hhariri.files.wordpress.com/2010/11/218.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="2" border="0" alt="2" src="http://hhariri.files.wordpress.com/2010/11/2_thumb6.png" width="282" height="249"></a> </p> <p>Similarly, the Test Runner Window offers us the same options. We get a new icon to run tests under coverage, as well as a new tab that will display the output of the coverage report.</p> <p><a href="http://hhariri.files.wordpress.com/2010/11/317.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="3" border="0" alt="3" src="http://hhariri.files.wordpress.com/2010/11/3_thumb6.png" width="462" height="249"></a> </p> <p>Based on the information we want to obtain, we can run coverage reports on the entire solution or only certain tests. Running on the entire solution will give us a measurement of how much our entire code base is covered. In order to do so, we can select <em>Cover All Tests from Solution</em>. You can assign whatever keyboard shortcut you want to this action by selecting the ReSharper_UnitTest_CoverSolution command, as shown below</p> <p><a href="http://hhariri.files.wordpress.com/2010/11/417.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="4" border="0" alt="4" src="http://hhariri.files.wordpress.com/2010/11/4_thumb6.png" width="299" height="249"></a> </p> <p>Executing the command will run the unit tests and once completed will then proceed to run a coverage report.</p> <p>We can also run coverage on individual tests or classes, by selecting them and choosing to Cover with dotCover</p> <p><a href="http://hhariri.files.wordpress.com/2010/11/517.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="5" border="0" alt="5" src="http://hhariri.files.wordpress.com/2010/11/5_thumb6.png" width="489" height="249"></a> </p> <p>Let’s try this on the <em>AccountController </em>tests. When we run the coverage, the unit tests will execute inside the ReSharper test runner and once completed, it will then proceed to run coverage reports. To view the results, we can click on the dotCover tab</p> <p><a href="http://hhariri.files.wordpress.com/2010/11/615.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="6" border="0" alt="6" src="http://hhariri.files.wordpress.com/2010/11/6_thumb4.png" width="356" height="249"></a> </p> <p>The window groups coverage reports based on the option selected in the dropdown list. We’re interested in the amount of coverage of our main assembly, not that of the tests (in the future we’ll able to filter test assemblies out). By expanding the node that references our assembly, we get more insight into the actual coverage. Notice that <em>HomeController </em>is at 0% coverage. This doesn’t mean that there are no tests, but that in this specific test run, none of the tests have been executed. This is because we chose to run only the <em>AccountController</em> tests.</p> <p>dotCover provides us with two measurements: percentage of code covered and number of statements. As such, if we have 83 statements in <em>AccountController </em>out of which 54 are covered with tests, that should indicate 65% coverage. Let’s dig a little deeper to see what is not covered.</p> <p><a href="http://hhariri.files.wordpress.com/2010/11/75.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="7" border="0" alt="7" src="http://hhariri.files.wordpress.com/2010/11/7_thumb4.png" width="644" height="228"></a> </p> <p>We can see that out of the eight actions, four have complete coverage and two have partial coverage. One of these with partial coverage is <em>ChangePassword</em>. There are two overloaded actions for it and it’s a common pattern in ASP.NET MVC applications; one corresponding to a <em>GET </em>request and another to a <em>POST</em>. The second one in the coverage report corresponds to the latter, and shows only 53% coverage. To see in more detail why this is, we can select the Highlight Code icon on the test runner panel</p> <p><a href="http://hhariri.files.wordpress.com/2010/11/85.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="8" border="0" alt="8" src="http://hhariri.files.wordpress.com/2010/11/8_thumb3.png" width="233" height="92"></a> </p> <p>This will highlight the paths of the code that are covered/not covered by tests. Next step is to select the <em>ChangePassword</em> action by double-clicking on it</p> <p><a href="http://hhariri.files.wordpress.com/2010/11/96.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="9" border="0" alt="9" src="http://hhariri.files.wordpress.com/2010/11/9_thumb4.png" width="564" height="249"></a> </p> <p>The lines colored in Cyan mean that they are covered by tests, whereas those in Lilac are not in the execution path of any of the executed tests. In the case of <em>ChangePassword </em>we can see that the test only covers the situation where the model state is valid. This allows us to easily identify non-happy paths of our application and make sure that when relevant, the correct tests are in place for it.</p> <p>&nbsp;</p> <h3>What’s coming…</h3> <p>dotCover is still in it’s infancy and we’ve got a lot planned in terms of features and functionality. Quite a few people have asked whether it will support running coverage reports from a console, which is important for continuous integration. dotCover will support running from a console with some basic functionality, and we have plans to include specific features for CI processes.</p> <p>If you’re not already following the dotCover <a href="http://twitter.com/dotCover">Twitter account</a>, make sure you do as we’ll release information and updates as things move forward.</p>
