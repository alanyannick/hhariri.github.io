---
layout: post
title: Generating Graphs for YouTrack with HTML 5 and jQuery
categories: []
tags:
- HTML
- JetBrains
- jQuery
- Tools
- YouTrack
status: publish
type: post
published: true
meta:
  reddit: a:2:{s:5:"count";i:0;s:4:"time";i:1385704324;}
  _oembed_69a847b10f32a3f39b86a324d5a25324: '{{unknown}}'
  _oembed_9e924a962f445cbccd2c367d0c76c23d: '{{unknown}}'
  _oembed_3d47217f2182d6144c8979f87143b210: '{{unknown}}'
  _elasticsearch_indexed_on: '2010-12-14 11:43:32'
comments: true
---
<p>A few days ago, a customer of ours asked me if it would be possible to visualize statistics in graphs in our <a href="http://www.jetbrains.com/youtrack">Bug Tracker YouTrack</a>. Answer is Yes. Since YouTrack offers a “ReSTful” API, you can obtain pretty much any kind of information you want from it and once you have this information, you can then display it however you wish, be it a table or a graph. </p> <p>Let’s see how.</p> <h3>What we’ll be using…</h3> <p>One of the great benefits of <a href="http://jquery.org/">jQuery</a> is the rich ecosystem it offers. There’s a plug-in for pretty much everything you need, even for displaying graphs. In fact there are quite a few. We’ll be using <a href="http://www.filamentgroup.com">jQuery Visualize</a>. We’ll also be using jQuery (I’m using 1.4.4 but should work with older version) and jQueryUI, which is needed by jQuery Visualize. Finally we’ll also need <a href="https://github.com/jquery/jquery-tmpl">jQuery Templates</a> (I’ll explain why later on).</p> <p>Don’t worry about downloading each individual file. Everything you’ll need is included in the demo code attached to this post. </p> <h3>Getting the information from YouTrack</h3> <p>For this demo, what we want to do is create a chart containing Issue counts for different projects. In particular, we are interested in Open, Fixed and Duplicate issues for <a href="http://www.jetbrains.com/resharper">ReSharper</a>, <a href="http://www.jetbrains.com/dotcover">dotCover</a> and <a href="http://www.jetbrains.com/profiler">dotTrace</a>:</p> <p><a href="http://hhariri.files.wordpress.com/2010/12/image10.png"><img style="display:inline;border-width:0;" title="image" border="0" alt="image" src="http://hhariri.files.wordpress.com/2010/12/image_thumb10.png" width="519" height="237"></a> </p> <p>In order to get this information from YouTrack we have to make a request to count the number of issues based on filters, i.e&nbsp; ReSharper + Open, ReSharper + Fixed, etc.*. The URL for this would be:</p> <p><em><a href="http://youtrack.host.com/rest/issue/count?filter=project:ReSharper%20state:Fixed">http://youtrack.host.com/rest/issue/count?filter=project:ReSharper<font color="#0066cc">%20</font>state:Fixed</a></em></p> <p>which is nothing other than a URL encoded version of a search expression we can enter directly into YouTrack’s web interface,but to the <em>rest</em> API. We therefore need to send requests from our web page to YouTrack to obtain this information. The way we can do this is with Ajax and JSONP which YouTrack supports. Using jQuery.ajax, our code would look like this:</p> <p><a href="http://hhariri.files.wordpress.com/2010/12/image11.png"><img style="display:inline;border-width:0;" title="image" border="0" alt="image" src="http://hhariri.files.wordpress.com/2010/12/image_thumb11.png" width="859" height="136"></a> </p> <p>Problem is, this wouldn’t work, or at least, not always. When requesting a count of issues by YouTrack, the response is not immediate. YouTrack will free the request and will spin off to calculate the count. Once it’s complete it will then store the information in the cache. Next time a request is made, the value from the cache will be returned. What this means to us is that if we fire off a request, if it’s a cache miss, then we will get back a –1 instead of the actual count. We would therefore need to send a new request, until we get a value greater or equal to 0. This is not complicated to do with JavaScript and in particular with jQuery. It merely consists of polling for a result. But like all things jQuery, before you re-invent the wheel, check to see if there’s already a wheel and it turns to your liking, <a href="http://69.89.31.214/~nickrigg/wp-content/uploads/2009/08/ajaxPoll.js">something which in this case does</a>. This alternative to $.ajax allows us to poll servers and only process the result if a condition is met. As such, our previous code would now look like this:</p> <p>&nbsp;<a href="http://hhariri.files.wordpress.com/2010/12/image12.png"><img style="display:inline;border-width:0;" title="image" border="0" alt="image" src="http://hhariri.files.wordpress.com/2010/12/image_thumb12.png" width="830" height="174"></a> </p> <p>(the polling interval can be set for the calls. Here we’re using the default value). </p> <p>In terms of requesting information from YouTrack, that’s all there is to it. What we need to do now is repeat the process for each project and status type and store the value. </p> <p>[* Currently YouTrack does not support grouping so multiple requests will have to be made. This feature is planned however]</p> <h3>Representing the information as a table using jQuery Templates</h3> <p>We want to do two things with the results, represent them as an HTML table and display them as a graph. The data retrieved from the server is given to us as an array of objects (something we did in the code ourselves), where each object has a one property indicating the Project and three additional properties with the values of each status:</p> <p><a href="http://hhariri.files.wordpress.com/2010/12/image13.png"><img style="display:inline;border-width:0;" title="image" border="0" alt="image" src="http://hhariri.files.wordpress.com/2010/12/image_thumb13.png" width="461" height="100"></a>&nbsp;</p> <p>We would now need to iterate through this array and generate a table from it. Instead of doing this in an ugly way by mixing tags with data, we can take advantage of jQuery templates (if you are not familiar with templates, you can think of them as a view engine for jQuery). What we do is define a template and then make a call to a function that replaces placeholders with our data. If the data we provide this function is an array, it will repeat it for each entry. </p> <p><a href="http://hhariri.files.wordpress.com/2010/12/image14.png"><img style="display:inline;border-width:0;" title="image" border="0" alt="image" src="http://hhariri.files.wordpress.com/2010/12/image_thumb14.png" width="795" height="182"></a> </p> <p>The code first creates the template for the markup we want to generate, which are rows of a table. It then calls the <em>template </em>function to create a compiled version of the template which will then be passed in to the <em>tmpl</em> function along with the data (the <em>series </em>variable). The call to <em>appendTo </em>is a jQuery method which adds the contents of the object it’s called on to the item passed in to the selector (in this case <em>#rows</em>).&nbsp; </p> <p>In the body section of our page, we can then define the rest of the table, which includes the header and the tag for the table body:</p> <p><a href="http://hhariri.files.wordpress.com/2010/12/image15.png"><img style="display:inline;border-width:0;" title="image" border="0" alt="image" src="http://hhariri.files.wordpress.com/2010/12/image_thumb15.png" width="332" height="245"></a> </p> <h3>Creating the Graph</h3> <p>So far we have retrieved the information from YouTrack and created an HTML table to display it. Our main objective however was to also display this information graphically. That in fact is the easiest part. One reason we are using jQuery Visualize is because it can easily convert a table into a graph (it supports different types of graphs, including lines, pies, etc.). All we need to do is call <em>visualize </em>on a table.</p> <p><a href="http://hhariri.files.wordpress.com/2010/12/image16.png"><img style="display:inline;border-width:0;" title="image" border="0" alt="image" src="http://hhariri.files.wordpress.com/2010/12/image_thumb16.png" width="551" height="33"></a> </p> <p>That’s all there is to it. Once we put all the pieces together, we will end up with the following page:</p> <p><a href="http://hhariri.files.wordpress.com/2010/12/image32.png"><img style="display:inline;border-width:0;" title="image" border="0" alt="image" src="http://hhariri.files.wordpress.com/2010/12/image32_thumb.png" width="640" height="659"></a> </p> <h3></h3> <p>This chart works in all browsers I’ve tested (IE 9, Opera, Firefox and Chrome)</p> <h3>Summary</h3> <p>The complete code for requesting information from YouTrack and generating the Graphs is available on my <a href="https://github.com/hhariri/Blog">GitHub Blog repository</a>. Once you examine it, you’ll see that it’s very few lines of code, thanks to the rich ecosystem around jQuery. I’m sure it can even be improved further, since I am by far a jQuery expert and can also be made a bit more generic to allow for different statistics to be obtained without change to the source.</p> <p>I’m currently working on <a href="https://github.com/hhariri/YouTrackSharp">YouTrackSharp</a> which is a wrapper for YouTrack requests in C#. So if you’re interested in doing the same thing from C#, you will soon be able to do. </p> <p>As always, if you have any questions please leave a comment. </p> <p>Enjoy!</p>
