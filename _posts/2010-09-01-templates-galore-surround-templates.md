---
layout: post
title: 'Templates Galore: Surround Templates'
categories: []
tags:
- ReSharper
status: publish
type: post
published: true
meta:
  reddit: a:2:{s:5:"count";i:0;s:4:"time";i:1385704331;}
  _elasticsearch_indexed_on: '2010-09-01 14:26:54'
comments: true
---
<p>This is part three of a four part series on Templates:</p>  <ul>   <li><a href="http://hadihariri.com/blogengine/post/2010/08/06/Templates-Galore-Live-Templates.aspx">Live Templates</a> </li>    <li><a href="http://hadihariri.com/blogengine/post/2010/08/24/Templates-Galore-File-Templates.aspx">File Templates</a> </li>    <li>Surround Templates </li>    <li>Extending Functionality with Macros </li> </ul>  <p>Surround templates, as the name indicates, allow us to surround a selection of text and apply a transformation to it. This can be from wrapping some code inside a try..catch block or performing more complex tasks such as iterations.</p>  <h3>Surround Template Gallery </h3>  <p>As with Live Templates and File Templates, we can view the list of available Surround Templates via the <strong>Live Templates </strong>entry in the <a href="http://www.jetbrains.com/resharper">ReSharper</a> menu (for the record, I’ve filed a request for it to be renamed to the more appropriate Template Explorer, so feel free to support my request by <a href="http://youtrack.jetbrains.net/issue/RSRP-189189">voting for it</a>).</p>  <p><a href="http://hhariri.files.wordpress.com/2010/11/110.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="1" border="0" alt="1" src="http://hhariri.files.wordpress.com/2010/11/1_thumb.png" width="373" height="382" /></a> </p>  <p>The layout is similar to File Templates. The right-hand side column allows us to define a “quick list” of Surround Templates we want available based on context. Like before, we can first see how to use existing ones and then expand them by adding new ones.</p>  <h3>Invoking a Surround Template</h3>  <p>Like pretty much everything in ReSharper, we can invoke Surround Templates using the ReSharper menu (<strong>ReSharper|Edit|Surround with Template</strong>) or alternatively and more conveniently via the shortcut, which is <strong>Ctrl+E,U</strong> if using Visual Studio Scheme (<strong>Ctrl+Alt+J</strong> for IntelliJ).</p>  <p>Let’s assume we have some code that we need to wrap in a try..catch block. We first select the line(s) of code, press Cltr+E,U and ReSharper prompts a menu for us to select the specific template. Each entry is numbered, allowing us to quickly make a selection (in this case it would be 8)</p>  <p><a href="http://hhariri.files.wordpress.com/2010/11/210.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="2" border="0" alt="2" src="http://hhariri.files.wordpress.com/2010/11/2_thumb.png" width="365" height="169" /></a> </p>  <p>The selected part of the code is then wrapped inside the try..catch part (later on we’ll see how this is defined), resulting in:</p>  <p><a href="http://hhariri.files.wordpress.com/2010/11/310.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="3" border="0" alt="3" src="http://hhariri.files.wordpress.com/2010/11/3_thumb.png" width="373" height="95" /></a> </p>  <p>This is not limited to C# code, but can be used in Visual Basic as well as HTML (ASPX) and XML pages. Take the following text in an ASPX page:</p>  <p><a href="http://hhariri.files.wordpress.com/2010/11/410.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="4" border="0" alt="4" src="http://hhariri.files.wordpress.com/2010/11/4_thumb.png" width="390" height="67" /></a> </p>  <p>Invoking the Surround Templates provides us with the option to surround it with a tag, link or other constructs. In this particular case, if we select a tag, we’ll be presented with a second menu which allows us to define the actual tag. ReSharper provides a list of all tags currently on the page, but we are free to start typing our own:</p>  <p><a href="http://hhariri.files.wordpress.com/2010/11/510.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="5" border="0" alt="5" src="http://hhariri.files.wordpress.com/2010/11/5_thumb.png" width="341" height="119" /></a> </p>  <p>as shown here (writing span):</p>  <p><a href="http://hhariri.files.wordpress.com/2010/11/71.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="7" border="0" alt="7" src="http://hhariri.files.wordpress.com/2010/11/7_thumb.png" width="337" height="82" /></a> </p>  <p>or when iterating over a series of fields, we can invoke the <strong>foreach </strong>template:</p>  <p><a href="http://hhariri.files.wordpress.com/2010/11/92.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="9" border="0" alt="9" src="http://hhariri.files.wordpress.com/2010/11/9_thumb.png" width="304" height="132" /></a> </p>  <p>resulting in:</p>  <p><a href="http://hhariri.files.wordpress.com/2010/11/102.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="10" border="0" alt="10" src="http://hhariri.files.wordpress.com/2010/11/10_thumb.png" width="284" height="200" /></a> </p>  <p>&#160;</p>  <h3>Creating new Surround Templates</h3>  <p>Below is a typical MVC Action. We receive a customer and save it to a repository</p>  <p><a href="http://hhariri.files.wordpress.com/2010/11/112.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="11" border="0" alt="11" src="http://hhariri.files.wordpress.com/2010/11/11_thumb.png" width="312" height="94" /></a> </p>  <p>The data however might not always be valid. That’s why it’s wise to validate it before operating on the data. This is usually done in ASP.NET MVC checking the <strong>IsValid </strong>property of <strong>ModelState: </strong></p>  <p><a href="http://hhariri.files.wordpress.com/2010/11/122.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="12" border="0" alt="12" src="http://hhariri.files.wordpress.com/2010/11/12_thumb.png" width="310" height="157" /></a> </p>  <p>Let’s see how we can easily make a Surround Template to do this for us, that is go from the single <strong>_customerRepository.Save(customer) </strong>to the code above*.</p>  <p>1. Open the <strong>Surround Te     <br />mplate </strong>tab using <strong>ReSharper | Live Templates | Surround Templates</strong></p>  <p>2. Create a new User Template, by right-clicking on <strong>User Template </strong>and selecting <strong>New Template</strong></p>  <p><a href="http://hhariri.files.wordpress.com/2010/11/132.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="13" border="0" alt="13" src="http://hhariri.files.wordpress.com/2010/11/13_thumb.png" width="319" height="213" /></a> </p>  <p>3. Enter the follow text in the Template Editor, giving it the name ModelState:</p>  <p><a href="http://hhariri.files.wordpress.com/2010/11/142.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="14" border="0" alt="14" src="http://hhariri.files.wordpress.com/2010/11/14_thumb.png" width="328" height="252" /></a> </p>  <p>With Live Templates and File Templates, we generate text from scratch. With Surround Templates, we mostly select existing text and our intention is to work with it. As such, ReSharper offers a series of pre-defined variables that helps us with this task:</p>  <table border="0" cellspacing="0" cellpadding="2" width="400"><tbody>     <tr>       <td valign="top" width="105">Variable</td>        <td valign="top" width="295">Description</td>     </tr>      <tr>       <td valign="top" width="105">$SELECTION$</td>        <td valign="top" width="295">The selected text when invoking the template</td>     </tr>      <tr>       <td valign="top" width="105">$END$</td>        <td valign="top" width="295">Where the cursor should be placed on termination of template interaction</td>     </tr>      <tr>       <td valign="top" width="105">$SELSTART$</td>        <td valign="top" width="295">Denotes the start of selected text after template has been invoked</td>     </tr>      <tr>       <td valign="top" width="105">$SELEND$</td>        <td valign="top" width="295">Denotes end of selected text after template has been invoked</td>     </tr>   </tbody></table>  <p>The new items here are $SELECTION$, $SELSTART$ and $SELEND$, which we’ll see their purpose shortly. As always, anything else in between the $ will act as a variable on which we can apply a macro.</p>  <p>4. Similar to File Templates, in order to make this efficient, we need to add it to the quick list of templates. Drag the newly created template. You can optionally set the filter to C# files only. See previous entry on <a href="http://hadihariri.com/blogengine/post/2010/08/06/Templates-Galore-Live-Templates.aspx">Live Templates to see how to do that</a></p>  <p>&#160;</p>  <p><a href="http://hhariri.files.wordpress.com/2010/11/152.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="15" border="0" alt="15" src="http://hhariri.files.wordpress.com/2010/11/15_thumb.png" width="372" height="223" /></a> </p>  <p>5. Close the Template Editor.</p>  <p>6. Select the line of text we want wrapped in the template and press Ctrl+E,U. Choose ModelState</p>  <p><a href="http://hhariri.files.wordpress.com/2010/11/162.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="16" border="0" alt="16" src="http://hhariri.files.wordpress.com/2010/11/16_thumb.png" width="380" height="153" /></a> </p>  <p>We should now end up with the following:</p>  <p><a href="http://hhariri.files.wordpress.com/2010/11/172.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="17" border="0" alt="17" src="http://hhariri.files.wordpress.com/2010/11/17_thumb.png" width="399" height="190" /></a> </p>  <h3>Refining the template</h3>  <p>As it is now, the Surround Template created assumes that we always want to perform a <em>RedirectToAction</em>, which is the norm**. If however on occasions we want to perform some other operation, we can make it easier to replace the default <em>RedirectToAction </em>call by selecting the text. As such, all we need to do is start typing to delete it. We can do this using the $SELSTART$ and $SELEND$ variables as shown below:</p>  <p><a href="http://hhariri.files.wordpress.com/2010/11/182.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="18" border="0" alt="18" src="http://hhariri.files.wordpress.com/2010/11/18_thumb.png" width="398" height="71" /></a> </p>  <p>This is now telling ReSharper to prompt for the variables, but to ultimately select the entire <em>RedirectToAction </em>for us to replace it if required. If we are OK with this default, we can hit ESC. We also change the order in which the variables are prompted for to make it more convenient.</p>  <h3>Summary</h3>  <p>Surround Templates offer us a way to conveniently add construct around existing code with ease. They are different than Live and File templates in that the concept of a selection exists. With Surround Templates, we cover the three different types of Templates that exist in ReSharper. In the last part of this four part series we’ll see how we can create new macros to extend the ones ReSharper offers us when playing with variables. This will allow us to do all sorts of things with templates.</p>  <p>&#160;</p>  <h4>Notes</h4>  <p>* I’ve used this as an example because it’s all too common to see this approach. Personally however, I recommended using AOP to avoid constant repetitive code duplication across actions.</p>  <p>** This is known as the PRG pattern: POST-Redirect-GET. The reason we do this and not return a View is because if the user presses the Refresh button in the browser, it would act as a new POST. In this case maybe nothing will occur, but think about adding new records for instance. By first performing a Redirect and then doing a GET for Index, a refresh will only cause a new GET of the request we redirected to (in this case Index action).</p>
