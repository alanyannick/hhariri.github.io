---
layout: post
title: Checking for a null Model in ASP.NET MVC
categories: []
tags:
- ASP.NET MVC
status: publish
type: post
published: true
meta:
  _oembed_c2bc208eb2d7cc7f3935154cda8ed26c: '{{unknown}}'
  _elasticsearch_indexed_on: '2010-04-30 14:26:00'
comments: true
---
<p>&#160;</p>  <p>It is considered good practice to use strongly-typed models when working with ASP.NET MVC. That is, instead of doing something like</p>  <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:469965fa-2798-4a83-814d-19e6f8ef36dd" class="wlWriterEditableSmartContent"> <div class="le-pavsc-container"> <div style="background-color:#000000;max-height:300px;overflow:auto;white-space:nowrap;padding:2px 5px;"><span style="color:#ffffff;">ViewData[</span><span style="color:#a5c25c;">&quot;CustomerName&quot;</span><span style="color:#ffffff;">] = </span><span style="color:#a5c25c;">&quot;John Smith&quot;</span><span style="color:#ffffff;">;</span></div> </div> </div>  <p>   <br />you would do </p>  <p>   <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:16f78d50-e190-4bda-a237-087384eb8b39" class="wlWriterEditableSmartContent"> <div class="le-pavsc-container"> <div style="background-color:#000000;max-height:300px;overflow:auto;white-space:nowrap;padding:2px 5px;"><span style="color:#ffffff;"></span><span style="color:#cc7832;">var</span><span style="color:#ffffff;"> customer = </span><span style="color:#cc7832;">new</span><span style="color:#ffffff;"> </span><span style="color:#ffc66d;">Customer</span><span style="color:#ffffff;">() { Name = </span><span style="color:#a5c25c;">&quot;John Smith&quot;}</span><span style="color:#ffffff;">;</span><br /> <br /> <span style="color:#ffffff;"></span><span style="color:#cc7832;">return</span><span style="color:#ffffff;"> View(customer);</span></div> </div> </div> </p>  <p>Using this approach however, has a minor issue. Let’s say someone makes the following request:</p>  <p><a href="http://server.com/customer/details/34">http://server.com/customer/details/34</a></p>  <p>and the corresponding Action that processes this is:    <br /></p> <a href="http://11011.net/software/vspaste"></a>  <p>&#160;</p>  <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:05c9dbc1-19ee-4fe1-9464-e5c7dd4e92c0" class="wlWriterEditableSmartContent"> <div class="le-pavsc-container"> <div style="background-color:#000000;max-height:300px;overflow:auto;white-space:nowrap;padding:2px 5px;"><span style="color:#ffffff;"></span><span style="color:#cc7832;">public</span><span style="color:#ffffff;"> </span><span style="color:#ffc66d;">ActionResult</span><span style="color:#ffffff;"> Details(</span><span style="color:#cc7832;">int</span><span style="color:#ffffff;"> id)</span><br /> <span style="color:#ffffff;">{</span><br />     <span style="color:#ffffff;"></span><br /> <br />     <span style="color:#ffffff;"></span><span style="color:#cc7832;">var</span><span style="color:#ffffff;"> customer = _customerServices.GetCustomerById(id);</span><br /> <br />     <span style="color:#ffffff;"></span><span style="color:#cc7832;">return</span><span style="color:#ffffff;"> View(customer);</span><br /> <span style="color:#ffffff;">}</span></div> </div> </div>  <p>&#160;</p>  <p>if customer with 34 does not exist, you’ll have a problem at runtime if you’ve not made the necessary null checks. This occurs because the View will most likely display the name via the Model property, which is null. </p>  <p>&lt;p&gt;   <br />&#160;&#160;&#160; Name:    <br />&#160;&#160;&#160; &lt;%: Model.Name %&gt;    <br />&lt;/p&gt; </p>  <p>The most common solution to this problem is to do a null check, either at the controller level, by checking to see if the model is null before passing it to the View, or alternatively in the View, before accessing the model property. If doing the latter, the normal thing would be to extract this into an Html helper to avoid having continuous checks for each property. </p>  <h2>Using Action Filters</h2>  <p>&#160;</p>  <p>ASP.NET MVC has a series of filters, which are applied before and after certain events take place. An Action filter has four methods that are of particular interest:</p>  <ul>   <li><strong>OnActionExecuting</strong>: Takes places <strong>before</strong> an action is executed</li>    <li><strong>OnActionExecuted</strong>: Takes place <strong>after</strong> an action is executed</li>    <li><strong>OnResultExecuting</strong>: Takes place <strong>before</strong> a result is executed</li>    <li><strong>OnResultExecuted</strong>: Takes place <strong>after</strong> a result is executed</li> </ul>  <p>We can leverage these methods to intercept the request/response when an action is executed. For instance we could override <em>OnActionExecuting </em>to perform authorization or override <em>OnActionExecuting </em>to implement some kind of auditing. </p>  <p>In our case, what is interesting however is the <em>OnResultExecuting</em>, which occurs <em>after</em> an Action has executed and <em>before </em>the actual view is rendered. If we could hook into this, we could check to see if the Model passed in is null and if so, do something about it, thus preventing the View from giving a null reference exception while trying to access a null model. </p>  <p>One way to accomplish this is to create a new filter by inheriting from <em>ActionFilterAttribute </em>and overriding the corresponding method:</p>  <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:843c2c62-7de3-4e53-ae5f-72afecf2edae" class="wlWriterEditableSmartContent"> <div class="le-pavsc-container"> <div style="background-color:#000000;max-height:300px;overflow:auto;white-space:nowrap;padding:2px 5px;"><span style="color:#ffffff;"> </span><span style="color:#cc7832;">public</span><span style="color:#ffffff;"> </span><span style="color:#cc7832;">class</span><span style="color:#ffffff;"> </span><span style="color:#ffc66d;">HandleRecordNotFoundAttribute</span><span style="color:#ffffff;"> : </span><span style="color:#ffc66d;">ActionFilterAttribute</span><br />     <span style="color:#ffffff;">{</span><br />         <span style="color:#ffffff;"></span><span style="color:#cc7832;">public</span><span style="color:#ffffff;"> </span><span style="color:#cc7832;">override</span><span style="color:#ffffff;"> </span><span style="color:#cc7832;">void</span><span style="color:#ffffff;"> OnResultExecuting(</span><span style="color:#ffc66d;">ResultExecutingContext</span><span style="color:#ffffff;"> filterContext)</span><br />         <span style="color:#ffffff;">{</span><br />           <span style="color:#ffffff;"></span><span style="color:#cc7832;">var</span><span style="color:#ffffff;"> viewResult = filterContext.Result </span><span style="color:#cc7832;">as</span><span style="color:#ffffff;"> </span><span style="color:#ffc66d;">ViewResult</span><span style="color:#ffffff;">;</span><br /> <br />           <span style="color:#ffffff;"></span><span style="color:#cc7832;">if</span><span style="color:#ffffff;"> (viewResult != </span><span style="color:#cc7832;">null</span><span style="color:#ffffff;"> &amp;&amp; viewResult.ViewData.Model == </span><span style="color:#cc7832;">null</span><span style="color:#ffffff;">)</span><br />           <span style="color:#ffffff;">{</span><br />             <span style="color:#ffffff;">filterContext.Result = </span><span style="color:#cc7832;">new</span><span style="color:#ffffff;"> </span><span style="color:#ffc66d;">ResourceNotFoundResult</span><span style="color:#ffffff;">();</span><br />             <span style="color:#ffffff;">filterContext.Result.ExecuteResult(filterContext.Controller.ControllerContext);</span><br />           <span style="color:#ffffff;">}</span><br />         <span style="color:#ffffff;">}</span><br />     <span style="color:#ffffff;">}</span></div> </div> </div>  <p>&#160;</p>  <p>What we’ve done is first get the View that is going to be returned. If
 it is not null we then check to see if the Model is null. If it is, we return a 404 result, which indicates that the resource requested does not exist. If none of the previous conditions are met, we then just let the response take its course and not interfere. The <em>ResourceNotFoundResult </em>is simply an <em>HttpException</em> wrapper that returns an <em>ActionResult</em>. </p>  <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:14182158-f153-4571-8d68-c74f90b1ce47" class="wlWriterEditableSmartContent"> <div class="le-pavsc-container"> <div style="background-color:#000000;max-height:300px;overflow:auto;white-space:nowrap;padding:2px 5px;"><span style="color:#ffffff;"></span><span style="color:#cc7832;">public</span><span style="color:#ffffff;"> </span><span style="color:#cc7832;">class</span><span style="color:#ffffff;"> </span><span style="color:#ffc66d;">ResourceNotFoundResult</span><span style="color:#ffffff;"> : </span><span style="color:#ffc66d;">ActionResult</span><br /> <span style="color:#ffffff;">{</span><br />     <span style="color:#ffffff;"></span><span style="color:#cc7832;">public</span><span style="color:#ffffff;"> </span><span style="color:#cc7832;">string</span><span style="color:#ffffff;"> Message { </span><span style="color:#cc7832;">get</span><span style="color:#ffffff;">; </span><span style="color:#cc7832;">private</span><span style="color:#ffffff;"> </span><span style="color:#cc7832;">set</span><span style="color:#ffffff;">; }</span><br /> <br />     <span style="color:#ffffff;"></span><span style="color:#cc7832;">public</span><span style="color:#ffffff;"> ResourceNotFoundResult()</span><br />     <span style="color:#ffffff;">{</span><br />         <span style="color:#ffffff;">Message = </span><span style="color:#a5c25c;">&quot;The requested resource was not found&quot;</span><span style="color:#ffffff;">;</span><br />     <span style="color:#ffffff;">}</span><br /> <br />     <span style="color:#ffffff;"></span><span style="color:#cc7832;">public</span><span style="color:#ffffff;"> ResourceNotFoundResult(</span><span style="color:#cc7832;">string</span><span style="color:#ffffff;"> message)</span><br />     <span style="color:#ffffff;">{</span><br />         <span style="color:#ffffff;">Message = message;</span><br />     <span style="color:#ffffff;">}</span><br />     <span style="color:#ffffff;"></span><span style="color:#cc7832;">public</span><span style="color:#ffffff;"> </span><span style="color:#cc7832;">override</span><span style="color:#ffffff;"> </span><span style="color:#cc7832;">void</span><span style="color:#ffffff;"> ExecuteResult(</span><span style="color:#ffc66d;">ControllerContext</span><span style="color:#ffffff;"> context)</span><br />     <span style="color:#ffffff;">{</span><br />         <span style="color:#ffffff;"></span><span style="color:#cc7832;">throw</span><span style="color:#ffffff;"> </span><span style="color:#cc7832;">new</span><span style="color:#ffffff;"> </span><span style="color:#ffc66d;">HttpException</span><span style="color:#ffffff;">(</span><span style="color:#6897bb;">404</span><span style="color:#ffffff;">, Message);</span><br />     <span style="color:#ffffff;">}</span><br /> <span style="color:#ffffff;">}</span></div> </div> </div>  <p>&#160;</p>  <p>Finally, to use this, all we need to do is just tag the corresponding action with the attribute. This way, instead of continuously having code like this: </p>  <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:705af26a-8f7d-4e3c-a081-478b847e3941" class="wlWriterEditableSmartContent"> <div class="le-pavsc-container"> <div style="background-color:#000000;max-height:300px;overflow:auto;white-space:nowrap;padding:2px 5px;"><span style="color:#ffffff;"></span><span style="color:#cc7832;">public</span><span style="color:#ffffff;"> </span><span style="color:#ffc66d;">ActionResult</span><span style="color:#ffffff;"> Details(</span><span style="color:#cc7832;">int</span><span style="color:#ffffff;"> id)</span><br /> <span style="color:#ffffff;">{</span><br />     <span style="color:#ffffff;"></span><br /> <br />     <span style="color:#ffffff;"></span><span style="color:#cc7832;">var</span><span style="color:#ffffff;"> customer = _customerServices.GetCustomerById(id);</span><br /> <br />     <span style="color:#ffffff;"></span><span style="color:#cc7832;">if</span><span style="color:#ffffff;"> (customer == </span><span style="color:#cc7832;">null</span><span style="color:#ffffff;">)</span><br />     <span style="color:#ffffff;">{</span><br />         <span style="color:#ffffff;"></span><span style="color:#cc7832;">return</span><span style="color:#ffffff;"> </span><span style="color:#cc7832;">new</span><span style="color:#ffffff;"> </span><span style="color:#ffc66d;">ResourceNotFoundResult</span><span style="color:#ffffff;">();</span><br />     <span style="color:#ffffff;">}</span><br />     <span style="color:#ffffff;"></span><span style="color:#cc7832;">return</span><span style="color:#ffffff;"> View(customer);</span><br /> <span style="color:#ffffff;">}</span></div> </div> </div>  <p>&#160;</p>  <p>we can have:</p>  <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:2c4e09fb-74bf-4721-9a30-e2a82c745ae3" class="wlWriterEditableSmartContent"> <div class="le-pavsc-container"> <div style="background-color:#000000;max-height:300px;overflow:auto;white-space:nowrap;padding:2px 5px;"><span style="color:#ffffff;">[</span><span style="color:#ffc66d;">HandleRecordNotFound</span><span style="color:#ffffff;">]</span><br /> <span style="color:#ffffff;"></span><span style="color:#cc7832;">public</span><span style="color:#ffffff;"> </span><span style="color:#ffc66d;">ActionResult</span><span style="color:#ffffff;"> Details(</span><span style="color:#cc7832;">int</span><span style="color:#ffffff;"> id)</span><br /> <span style="color:#ffffff;">{</span><br />     <span style="color:#ffffff;"></span><span style="color:#cc7832;">var</span><span style="color:#ffffff;"> customer = _customerServices.GetCustomerById(id);</span><br />     <span style="color:#ffffff;"></span><br />     <span style="color:#ffffff;"></span><span style="color:#cc7832;">return</span><span style="color:#ffffff;"> View(customer);</span><br /> <span style="color:#ffffff;">}</span></div> </div> </div>  <p></p>  <p>We could extend this to the controller by first checking the type of the result and not casting it directly to a ViewResult and set the attribute at the Controller level. I’ll leave that to anyone that wants to fork the code. One step further is to modify pipeline to not even require an attribute (but I’ve yet to play with that). </p>  <p>You can get the entire example from <a href="http://github.com/hhariri/Blog">here</a>. </p>
